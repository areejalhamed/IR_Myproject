<!-- <!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="utf-8">
    <title>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            direction: rtl;
        }

        input,
        select,
        button {
            margin: 10px 0;
            display: block;
            width: 300px;
            padding: 8px;
            font-size: 16px;
        }

        pre {
            background: #f0f0f0;
            padding: 10px;
            white-space: pre-wrap;
            text-align: start;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }

        table, th, td {
            border: 1px solid #bbb;
        }

        th {
            background-color: #4CAF50;
            color: white;
            padding: 8px;
        }

        td {
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        h3, h4 {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>ğŸ—‚ï¸ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</h1>

    <form id="queryForm">
        <label for="queryInput">Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…:</label>
        <input type="text" id="queryInput" name="query" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù‡Ù†Ø§">

        <label for="datasetSelect">Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</label>
        <select id="datasetSelect" name="table_name">
            <option value="documents_beir_quora_dev">beir_quora_dev</option>
            <option value="documents_antique_test">antique_test</option>
        </select>

        <label for="representationSelect">Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…Ø«ÙŠÙ„:</label>
        <select id="representationSelect" name="representation">
            <option value="tfidf">TF-IDF</option>
            <option value="bert">BERT</option>
            <option value="hybrid">Hybrid</option>
        </select>

        <label for="modeSelect">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¶Ø¹:</label>
        <select id="modeSelect" name="mode">
            <option value="basic">Ø£Ø³Ø§Ø³ÙŠ ÙÙ‚Ø·</option>
            <option value="basic_extra">Ø£Ø³Ø§Ø³ÙŠ + ØªØ­Ø³ÙŠÙ†</option>
        </select>

        <button type="submit">ğŸ” Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</button>
    </form>

    <pre id="result"></pre>

    <script>
        const form = document.getElementById("queryForm");
        const resultDiv = document.getElementById("result");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            resultDiv.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";

            let query = document.getElementById("queryInput").value.trim();
            const table_name = document.getElementById("datasetSelect").value;
            const representation = document.getElementById("representationSelect").value;
            const mode = document.getElementById("modeSelect").value;

            const startTime = performance.now();
            let refinementInfo = "";

            try {
                // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙÙŠ Ø­Ø§Ù„Ø© basic_extra
                if (mode === "basic_extra") {
                    const refineRes = await fetch("/refine_query", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ query })
                    });

                    if (!refineRes.ok) {
                        throw new Error("ÙØ´Ù„ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…");
                    }

                    const refineData = await refineRes.json();
                    query = refineData.corrected_query;

                    refinementInfo += `<strong>ğŸ”§ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…:</strong><br>`;
                    refinementInfo += `â€¢ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù…ØµØ­Ø­: ${refineData.corrected_query}<br>`;
                    refinementInfo += `â€¢ Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©: ${refineData.similar_queries.join(" | ")}<br>`;
                    refinementInfo += `â€¢ Ù…ØµØ·Ù„Ø­Ø§Øª Ù…ÙˆØ³Ø¹Ø©: ${refineData.expanded_terms.join(", ")}<br><br>`;
                }

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
                const processRes = await fetch("/process_query", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query, table_name, representation })
                });

                if (!processRes.ok) {
                    const errorData = await processRes.json();
                    resultDiv.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:<br><pre>${JSON.stringify(errorData, null, 2)}</pre>`;
                    return;
                }

                // Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                const matchRes = await fetch("/query_match", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ table_name, representation, mode })
                });

                if (!matchRes.ok) {
                    const errorData = await matchRes.json();
                    resultDiv.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©:<br><pre>${JSON.stringify(errorData, null, 2)}</pre>`;
                    return;
                }

                const matchData = await matchRes.json();
                const endTime = performance.now();
                const elapsed = ((endTime - startTime) / 1000).toFixed(2);

                let resultHTML = refinementInfo + `<h3>âœ… Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>`;
                resultHTML += `<table>`;
                resultHTML += `<tr><th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</th><th>ID</th><th>Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ´Ø§Ø¨Ù‡</th></tr>`;

                matchData.results.forEach((item, index) => {
                    resultHTML += `<tr>
                        <td>${index + 1}</td>
                        <td>${item.doc_id}</td>
                        <td>${item.score.toFixed(4)}</td>
                    </tr>`;
                });

                resultHTML += `</table>`;

                // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯Ù‡
                if (matchData.clusters && matchData.clusters.length > 0) {
                    resultHTML += `<h3>ğŸ—‚ï¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¬Ù…ÙŠØ¹</h3>`;
                    matchData.clusters.forEach(cluster => {
                        resultHTML += `<h4>ğŸ”¸ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${cluster.cluster_id}</h4>`;
                        resultHTML += `<table>`;
                        resultHTML += `<tr><th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</th><th>Ø§Ù„Ù†Øµ</th></tr>`;
                        cluster.documents.forEach(doc => {
                            resultHTML += `<tr><td>${doc.doc_id}</td><td>${doc.cleaned_text}</td></tr>`;
                        });
                        resultHTML += `</table><br>`;
                    });
                }

                resultHTML += `<p>â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: ${elapsed} Ø«Ø§Ù†ÙŠØ©</p>`;
                resultDiv.innerHTML = resultHTML;

            } catch (error) {
                resultDiv.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ùˆ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`;
            }
        });
    </script>

</body>

</html>
 -->

 <!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="utf-8">
    <title>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            direction: rtl;
        }

        input,
        select,
        button {
            margin: 10px 0;
            display: block;
            width: 300px;
            padding: 8px;
            font-size: 16px;
        }

        pre {
            background: #f0f0f0;
            padding: 10px;
            white-space: pre-wrap;
            text-align: start;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }

        table, th, td {
            border: 1px solid #bbb;
        }

        th {
            background-color: #4CAF50;
            color: white;
            padding: 8px;
        }

        td {
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        h3, h4 {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>ğŸ—‚ï¸ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</h1>

    <form id="queryForm">
        <label for="queryInput">Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…:</label>
        <input type="text" id="queryInput" name="query" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù‡Ù†Ø§">

        <label for="datasetSelect">Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</label>
        <select id="datasetSelect" name="table_name">
            <option value="documents_beir_quora_dev">beir_quora_dev</option>
            <option value="documents_antique_test">antique_test</option>
        </select>

        <label for="representationSelect">Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…Ø«ÙŠÙ„:</label>
        <select id="representationSelect" name="representation">
            <option value="tfidf">TF-IDF</option>
            <option value="bert">BERT</option>
            <option value="hybrid">Hybrid</option>
        </select>

        <label for="modeSelect">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¶Ø¹:</label>
        <select id="modeSelect" name="mode">
            <option value="basic">Ø£Ø³Ø§Ø³ÙŠ ÙÙ‚Ø·</option>
            <option value="basic_extra">Ø£Ø³Ø§Ø³ÙŠ + ØªØ­Ø³ÙŠÙ†</option>
        </select>

        <button type="submit">ğŸ” Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</button>
    </form>

    <pre id="result"></pre>

    <script>
        const form = document.getElementById("queryForm");
        const resultDiv = document.getElementById("result");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            resultDiv.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";

            let query = document.getElementById("queryInput").value.trim();
            const table_name = document.getElementById("datasetSelect").value;
            const representation = document.getElementById("representationSelect").value;
            const mode = document.getElementById("modeSelect").value;

            const startTime = performance.now();
            let refinementInfo = "";

            try {
                // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙÙŠ Ø­Ø§Ù„Ø© basic_extra
                if (mode === "basic_extra") {
                    const refineRes = await fetch("/refine_query", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ query })
                    });

                    if (!refineRes.ok) {
                        throw new Error("ÙØ´Ù„ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…");
                    }

                    const refineData = await refineRes.json();
                    query = refineData.corrected_query;

                    refinementInfo += `<strong>ğŸ”§ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…:</strong><br>`;
                    refinementInfo += `â€¢ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù…ØµØ­Ø­: ${refineData.corrected_query}<br>`;
                    refinementInfo += `â€¢ Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©: ${refineData.similar_queries.join(" | ")}<br>`;
                    refinementInfo += `â€¢ Ù…ØµØ·Ù„Ø­Ø§Øª Ù…ÙˆØ³Ø¹Ø©: ${refineData.expanded_terms.join(", ")}<br><br>`;
                }

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
                const processRes = await fetch("/process_query", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ query, table_name, representation })
                });

                if (!processRes.ok) {
                    const errorData = await processRes.json();
                    resultDiv.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:<br><pre>${JSON.stringify(errorData, null, 2)}</pre>`;
                    return;
                }

                // Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                const matchRes = await fetch("/query_match", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ table_name, representation, mode })
                });

                if (!matchRes.ok) {
                    const errorData = await matchRes.json();
                    resultDiv.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©:<br><pre>${JSON.stringify(errorData, null, 2)}</pre>`;
                    return;
                }

                const matchData = await matchRes.json();
                const endTime = performance.now();
                const elapsed = ((endTime - startTime) / 1000).toFixed(2);

                let resultHTML = refinementInfo + `<h3>âœ… Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>`;
                resultHTML += `<table>`;
                resultHTML += `<tr><th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</th><th>ID</th><th>Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ´Ø§Ø¨Ù‡</th><th>Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø¸Ù</th></tr>`;

                matchData.results.forEach((item, index) => {
                    resultHTML += `<tr>
                        <td>${index + 1}</td>
                        <td>${item.doc_id}</td>
                        <td>${item.score.toFixed(4)}</td>
                        <td>${item.cleaned_text}</td>
                    </tr>`;
                });

                resultHTML += `</table>`;

                // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯Ù‡
                if (matchData.clusters && matchData.clusters.length > 0) {
                    resultHTML += `<h3>ğŸ—‚ï¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¬Ù…ÙŠØ¹</h3>`;
                    matchData.clusters.forEach(cluster => {
                        resultHTML += `<h4>ğŸ”¸ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${cluster.cluster_id}</h4>`;
                        resultHTML += `<table>`;
                        resultHTML += `<tr><th>ID</th><th>Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø¸Ù</th></tr>`;
                        cluster.documents.forEach(doc => {
                            resultHTML += `<tr><td>${doc.doc_id}</td><td>${doc.cleaned_text}</td></tr>`;
                        });
                        resultHTML += `</table><br>`;
                    });
                }

                resultHTML += `<p>â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: ${elapsed} Ø«Ø§Ù†ÙŠØ©</p>`;
                resultDiv.innerHTML = resultHTML;

            } catch (error) {
                resultDiv.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ùˆ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ${error.message}`;
            }
        });
    </script>

</body>

</html>
